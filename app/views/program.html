<button ng-click='toggleEdit(false); editing = !editing' ng-show='showEditButton'>Edit</button>
<div ng-hide='editing' class="row">
  <div class="col-xs-12 col-md-4 program-tree">
    <h3>{{ program.name }}</h3>
    <p><strong>Goal:</strong> {{ program.goal }}</p>
    <p><strong>Level:</strong> {{ program.level }}</p>
    <p><strong>Private:</strong> {{ program.private ? 'Yes' : 'No' }}</p>
    <p><strong>Days:</strong></p>
    <ul class="day-list">
      <li ng-repeat="day in program.program_days_attributes" class="day-item">
        <a class="expand-btn" ng-hide="editField">{{ day.name }} <div class="glyphicon glyphicon-pencil edit-btn" ng-click="editField = !editField"></div>  <div class="arrow"></div></a>
        <div class="edit-box" ng-show="editField"><input type="text" ng-model="day.name" value="{{ day.name }}"> <div ng-click="updateProgram(); editField = !editField" class="glyphicon glyphicon-check edit-btn"></div></div>
        <ul class="exercise-list">
          <li ng-repeat="ex in day.program_day_exercises_attributes" class="exercise-item">
            <a class="expand-btn">{{ ex.name }} <div class="arrow"></div></a>
            <ul class="set-list">
              <li ng-repeat="(i, set) in ex.program_day_exercise_sets_attributes" class="set-item">
                <a class="expand-btn">Set {{ i+1 }}: {{ set.reps }} reps</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</div>

<div ng-show='editing'>
  <form novalidate ng-submit="submit()">

    <div class="col-xs-12 col-md-4 col-md-offset-1">
      <div class="form-group">
        <label for="program-name">Name</label>
        <input type="text" placeholder="Name" ng-model="master.name" class="form-control" id="program-name">
      </div>
      <div class="form-group">
        <label for="goal-select">Goal</label>
        <select ng-model="master.goal" id="goal-select" class="select-primary">
          <option value="mass-gain">Mass gain</option>
          <option value="fat-loss">Fat loss</option>
          <option value="strength">Strength</option>
        </select>
      </div>
      <div class="form-group">
        <label for="level-select">Level</label>
        <select ng-model="master.level" id="level-select" class="select-primary">
          <option value="beginner">Beginner</option>
          <option value="intermmediate">Intermmediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>
      <div class="form-group">
        <label for="private-switch">Private</label>
        <div class="bootstrap-switch-square">
          <input type="checkbox" id="private-switch" data-on-text="<span class='fui-check'></span>" data-off-text="<span class='fui-cross'></span>" ng-model="master.private">
        </div>
      </div>
      <br>
      <button type="submit" class="btn btn-embossed btn-primary btn-hg btn-block">Save</button>
      <br>
      <br>
    </div>

    <div class="col-md-offset-1 col-xs-12 col-md-5">
      <div class="form-group form-inline" ui-tree="treeOptions">
        <!-- Days -->
        <ul ng-model="master.program_days_attributes" class="edit-list" ui-tree-nodes="" data-type="day">
          <li ng-repeat="day in master.program_days_attributes" on-finish-render="renderSelect2()" data-id="{{ day.id }}" ui-tree-node data-type="day" ng-init="dayIndex = $index">
            <div class="li-header">
              <a href ng-click="toggleDay = !toggleDay" ng-model="day" class="expand-btn"><i ng-hide="toggleDay" class="glyphicon glyphicon-chevron-down"></i><i ng-show="toggleDay" class="glyphicon glyphicon-chevron-right"></i></a>
              <input type="text" name="program_days_attributes[][name]" ng-model="day.name" class="input-sm day-field">
              <!-- <a href ng-click="addExercise(dayIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i></a> -->
              <a href ng-click="destroyDay(dayIndex)" ng-model="day" class="remove-btn"><i class="glyphicon glyphicon-remove"></i></a>
              <span ui-tree-handle class="ui-tree-handle"><i class="glyphicon glyphicon-menu-hamburger"></i></span>
            </div>
            <!-- Exercises -->
            <ul ng-hide="toggleDay" ng-model="day.program_day_exercises_attributes" ui-tree-nodes="" data-type="exercise" class="day-list">
              <li ng-repeat="ex in day.program_day_exercises_attributes" ui-tree-node data-type="exercise" ng-init="exIndex = $index">
                <div class="li-header">
                  <a href ng-click="toggleExercise = !toggleExercise" ng-model="ex" class="expand-btn"><i ng-show="toggleExercise" class="glyphicon glyphicon-chevron-down"></i><i ng-hide="toggleExercise" class="glyphicon glyphicon-chevron-right"></i></a>
                  <select name="program_days_attributes[][program_day_exercises_attributes][][name]" class="exercise-select select-primary" ng-model="ex" ng-options="exercise.name for exercise in exercises track by exercise.id">
                    <option value="">Select exercise</option>
                  </select>
                  <!-- <a href ng-click="addSet(dayIndex, exIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i></a> -->
                  <a href ng-click="destroyExercise(dayIndex, exIndex)" ng-model="ex" class="remove-btn"><i class="glyphicon glyphicon-remove"></i></a>
                  <span ui-tree-handle class="ui-tree-handle"><i class="glyphicon glyphicon-menu-hamburger"></i></span>
                </div>
                <!-- Sets -->
                <ul ng-hide="!toggleExercise" ng-model="ex.program_day_exercise_sets_attributes" ui-tree-nodes="" data-type="set" class="rep-list">
                  <li ng-repeat="(i, set) in ex.program_day_exercise_sets_attributes" ui-tree-node data-type="set">
                    <div class="li-header li-header-reps">
                      <label>Set {{ i+1 }}:</label>
                      <input type="number" name="program_days_attributes[][program_day_exercises_attributes][][program_day_exercise_sets_attributes][][reps]" ng-model="set.reps" class="rep-field input-sm"> <small>reps</small>
                      <a href ng-click="destroySet(dayIndex, exIndex, i)" ng-model="set" class="remove-btn"><i class="glyphicon glyphicon-remove"></i></a>
                      <span ui-tree-handle class="ui-tree-handle"><i class="glyphicon glyphicon-menu-hamburger"></i></span>
                    </div>
                  </li>
                  <li><a href ng-click="addSet(dayIndex, exIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i>Add set</a></li>
                </ul>
              </li>
              <li><a href ng-click="addExercise(dayIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i> Add exercise</a></li>
            </ul>
          </li>
        </ul>
        <a href ng-click="addDay()" ng-model="ex" class="add-day-btn"><i class="glyphicon glyphicon-plus"></i> Add day</a>
      </div>
    </div>
  </form>
</div>


<!-- <div id="search-overlay">
  <div id="search-input-box">
    <input type="text" id="search-input" placeholder="Type here to search">
    <a href="" class="glyphicon glyphicon-remove"></a>
  </div>
  <ul id="search-results">

  </ul>
  <div id="search-overlay-btns">
    <button class="btn btn-lg btn-primary btn-block" id="search-overlay-accept">Select</button>
    <button class="btn btn-lg btn-block" id="search-overlay-cancel">Cancel</button>
  </div>
</div> -->
