<!-- <button ng-click='toggleEdit(false); editing = !editing' ng-show='showEditButton'>Edit</button> -->
<div class="row nogutter">
  <div class="col-xs-12 col-md-3">
    <div id="global-edit" class="clearfix" ng-click="changeGlobalEdit()">{{ allowGlobalEdit ? 'Finish' : 'Edit' }}</div>
    <div id="program-name-box" style="clear:both">
      <h3 ng-hide="editNameField">
        <span ng-bind="program.name"></span>
        <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editNameField = !editNameField; $event.stopPropagation()"></div>
      </h3>
      <div ng-show="editNameField" class="edit-box"><input type="text" id="program-name-input" ng-model="program.name"><div ng-click="editNameField = !editNameField" class="glyphicon glyphicon-check edit-btn"></div></div>
    </div>
    <div class="program-option">
      <span>Goal:</span>
      <span ng-hide="editGoalField">
        <span ng-bind="program.goal"></span>
        <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editGoalField = !editGoalField"></div>
      </span>
      <span class="edit-box" ng-show="editGoalField">
        <select ng-model="program.goal">
          <option value="mass-gain">Mass gain</option>
          <option value="fat-loss">Fat loss</option>
          <option value="strength">Strength</option>
        </select>
      </span>
      <div ng-show="editGoalField" ng-click="editGoalField = !editGoalField" class="glyphicon glyphicon-check edit-btn"></div>
    </div>
    <div class="program-option">
      <span>Level:</span>
      <span ng-hide="editLevelField">
        <span ng-bind="program.level"></span>
        <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editLevelField = !editLevelField"></div>
      </span>
      <span class="edit-box" ng-show="editLevelField">
        <select ng-model="program.level">
          <option value="beginner">Beginner</option>
          <option value="intermmediate">Intermmediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </span>
      <div ng-show="editLevelField" ng-click="editLevelField = !editLevelField" class="glyphicon glyphicon-check edit-btn"></div>
    </div>
    <div class="program-option">
      <span>Private:</span>
      <span ng-hide="editPrivateField">
        {{ program.private ? 'Yes' : 'No' }}
        <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editPrivateField = !editPrivateField"></div>
      </span>
      <input type="checkbox" ng-model="program.private" ng-show="editPrivateField">
      <!-- <span class="edit-box" ng-show="editPrivateField">
        <span class="bootstrap-switch-square">
          <input type="checkbox" ng-model="program.private" id="private-switch" data-on-text="<span class='fui-check'></span>" data-off-text="<span class='fui-cross'></span>">
        </span>
      </span> -->
      <div ng-show="editPrivateField" ng-click="editPrivateField = !editPrivateField" class="glyphicon glyphicon-check edit-btn"></div>
    </div>
  </div>
  <div class="col-xs-12 col-md-offset-2 col-md-4 program-tree" id="program-routine" ui-tree="treeOptions" data-drag-enabled="treeEnabled">
    <h3>Routine <span id="reorder-btn" ng-show="allowGlobalEdit" ng-click="toggleTree($event)">{{ treeEnabled ? 'Finish' : 'Reorder' }}</span></h3>
    <!-- day list -->
    <ul class="day-list" ng-model="program.program_days_attributes" ui-tree-nodes="">
      <li ng-repeat="day in program.program_days_attributes" class="program-item day-item" ui-tree-node>
        <span ui-tree-handle ng-show="treeEnabled" class="ui-tree-handle glyphicon glyphicon-menu-hamburger"></span>
        <a class="program-item-text expand-btn" ng-hide="editDayField[$index]">
          <span ng-bind="day.name"></span>
          <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editDay(day, $index); $event.stopPropagation()"></div>
          <div class="arrow"></div>
        </a>
        <div class="edit-box" ng-show="editDayField[$index]">
          <input type="text" ng-model="day.name">
          <div ng-click="editDay(day, $index)" class="glyphicon glyphicon-check edit-btn"></div>
        </div>

        <!-- exercise list -->
        <ul class="exercise-list" ng-model="day.program_day_exercises_attributes" ui-tree-nodes="">
          <li ng-repeat="ex in day.program_day_exercises_attributes" class="program-item exercise-item" ui-tree-node>
            <span ui-tree-handle ng-show="treeEnabled" class="ui-tree-handle glyphicon glyphicon-menu-hamburger"></span>
            <a class="program-item-text expand-btn">
              <span ng-bind="ex.name"></span>
              <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editExercise(ex)"></div>
              <div class="arrow"></div>
            </a>

            <!-- set list -->
            <ul class="set-list" ng-model="ex.program_day_exercise_sets_attributes" ui-tree-nodes="">
              <li ng-repeat="set in ex.program_day_exercise_sets_attributes" class="program-item set-item" ui-tree-node>
                <span ui-tree-handle ng-show="treeEnabled" class="ui-tree-handle glyphicon glyphicon-menu-hamburger"></span>
                <span class="set-nr" ng-bind="$index+1"></span>
                <a class="program-item-text set-text" ng-hide="editSetField[$index]">
                  <span class=""><span ng-bind="set.reps"></span> <small>reps</small></span>
                  <div class="glyphicon glyphicon-pencil edit-btn" ng-show="allowGlobalEdit" ng-click="editSet(set, $index)"></div>
                </a>
                <div class="edit-box" ng-show="editSetField[$index]">
                  <input type="text" ng-model="set.reps">
                  <div class="glyphicon glyphicon-check edit-btn" ng-click="editSet(set, $index)"></div>
                </div>
              </li>
            </ul> <!-- end set list -->
          </li>
        </ul> <!-- end exercise list -->
      </li>
    </ul> <!-- end day list -->
  </div>
</div>





<div ng-show='editing' style="display: none">
  <form novalidate ng-submit="submit()">

    <!-- <div class="col-xs-12 col-md-4 col-md-offset-1">
      <div class="form-group">
        <label for="program-name">Name</label>
        <input type="text" placeholder="Name" ng-model="master.name" class="form-control" id="program-name">
      </div>
      <div class="form-group">
        <label for="goal-select">Goal</label>
        <select ng-model="master.goal" id="goal-select" class="select-primary">
          <option value="mass-gain">Mass gain</option>
          <option value="fat-loss">Fat loss</option>
          <option value="strength">Strength</option>
        </select>
      </div>
      <div class="form-group">
        <label for="level-select">Level</label>
        <select ng-model="master.level" id="level-select" class="select-primary">
          <option value="beginner">Beginner</option>
          <option value="intermmediate">Intermmediate</option>
          <option value="advanced">Advanced</option>
        </select>
      </div>
      <div class="form-group">
        <label for="private-switch">Private</label>
        <div class="bootstrap-switch-square">
          <input type="checkbox" id="private-switch" data-on-text="<span class='fui-check'></span>" data-off-text="<span class='fui-cross'></span>" ng-model="master.private">
        </div>
      </div>
      <br>
      <button type="submit" class="btn btn-embossed btn-primary btn-hg btn-block">Save</button>
      <br>
      <br>
    </div> -->

    <div class="col-md-offset-1 col-xs-12 col-md-5">
      <div class="form-group form-inline" ui-tree="treeOptions">
        <!-- Days -->
        <ul ng-model="master.program_days_attributes" class="edit-list" ui-tree-nodes="" data-type="day">
          <li ng-repeat="day in master.program_days_attributes" on-finish-render="renderSelect2()" data-id="{{ day.id }}" ui-tree-node data-type="day" ng-init="dayIndex = $index">
            <div class="li-header">
              <a href ng-click="toggleDay = !toggleDay" ng-model="day" class="expand-btn"><i ng-hide="toggleDay" class="glyphicon glyphicon-chevron-down"></i><i ng-show="toggleDay" class="glyphicon glyphicon-chevron-right"></i></a>
              <input type="text" name="program_days_attributes[][name]" ng-model="day.name" class="input-sm day-field">
              <!-- <a href ng-click="addExercise(dayIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i></a> -->
              <a href ng-click="destroyDay(dayIndex)" ng-model="day" class="remove-btn"><i class="glyphicon glyphicon-remove"></i></a>
              <span ui-tree-handle class="ui-tree-handle"><i class="glyphicon glyphicon-menu-hamburger"></i></span>
            </div>
            <!-- Exercises -->
            <ul ng-hide="toggleDay" ng-model="day.program_day_exercises_attributes" ui-tree-nodes="" data-type="exercise" class="day-list">
              <li ng-repeat="ex in day.program_day_exercises_attributes" ui-tree-node data-type="exercise" ng-init="exIndex = $index">
                <div class="li-header">
                  <a href ng-click="toggleExercise = !toggleExercise" ng-model="ex" class="expand-btn"><i ng-show="toggleExercise" class="glyphicon glyphicon-chevron-down"></i><i ng-hide="toggleExercise" class="glyphicon glyphicon-chevron-right"></i></a>
                  <select name="program_days_attributes[][program_day_exercises_attributes][][name]" class="exercise-select select-primary" ng-model="ex" ng-options="exercise.name for exercise in exercises track by exercise.id">
                    <option value="">Select exercise</option>
                  </select>
                  <!-- <a href ng-click="addSet(dayIndex, exIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i></a> -->
                  <a href ng-click="destroyExercise(dayIndex, exIndex)" ng-model="ex" class="remove-btn"><i class="glyphicon glyphicon-remove"></i></a>
                  <span ui-tree-handle class="ui-tree-handle"><i class="glyphicon glyphicon-menu-hamburger"></i></span>
                </div>
                <!-- Sets -->
                <ul ng-hide="!toggleExercise" ng-model="ex.program_day_exercise_sets_attributes" ui-tree-nodes="" data-type="set" class="rep-list">
                  <li ng-repeat="(i, set) in ex.program_day_exercise_sets_attributes" ui-tree-node data-type="set">
                    <div class="li-header li-header-reps">
                      <label>Set {{ i+1 }}:</label>
                      <input type="number" name="program_days_attributes[][program_day_exercises_attributes][][program_day_exercise_sets_attributes][][reps]" ng-model="set.reps" class="rep-field input-sm"> <small>reps</small>
                      <a href ng-click="destroySet(dayIndex, exIndex, i)" ng-model="set" class="remove-btn"><i class="glyphicon glyphicon-remove"></i></a>
                      <span ui-tree-handle class="ui-tree-handle"><i class="glyphicon glyphicon-menu-hamburger"></i></span>
                    </div>
                  </li>
                  <li><a href ng-click="addSet(dayIndex, exIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i>Add set</a></li>
                </ul>
              </li>
              <li><a href ng-click="addExercise(dayIndex)" ng-model="ex" class="add-btn"><i class="glyphicon glyphicon-plus"></i> Add exercise</a></li>
            </ul>
          </li>
        </ul>
        <a href ng-click="addDay()" ng-model="ex" class="add-day-btn"><i class="glyphicon glyphicon-plus"></i> Add day</a>
      </div>
    </div>
  </form>
</div>
